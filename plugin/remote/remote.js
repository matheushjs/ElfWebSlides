var RevealRemote=function(e){"use strict";const t=t=>{let o,n,i,r;const s={};let l,d={server:window.location.protocol+"//"+window.location.host,shareUrl:window.location.href,path:"/socket.io",multiplex:!0,remote:!0};const a=()=>{if(console.info("Remote: Connected - sending welcome message"),void 0===l.remoteMultiplexId){const e={type:"presenter",shareUrl:d.shareUrl};if(window.localStorage){const t=JSON.parse(window.localStorage.getItem("presentations")||"{}"),o=d.shareUrl.replace(/#.*/,"");t.hasOwnProperty(o)&&(e.hash=t[o].hash,e.remoteId=t[o].remoteId,e.multiplexId=t[o].multiplexId)}o.emit("start",e)}else o.emit("start",{type:"follower",id:l.remoteMultiplexId})};const c=(e,t)=>{n.href===t&&"none"!==r.style.display?r.style.display="none":(i.src=e,n.href=t,r.style.display="flex")},m=e=>{if(d.remote&&(t.addKeyBinding({keyCode:82,key:"R",description:"Show remote control url"},(()=>{c(e.remoteImage,e.remoteUrl)})),t.addEventListener("overviewshown",p),t.addEventListener("overviewhidden",p),t.addEventListener("paused",p),t.addEventListener("resumed",p),t.addEventListener("autoslidepaused",p),t.addEventListener("autoslideresumed",p),t.addEventListener("overviewshown",p),t.addEventListener("overviewhidden",p),t.addEventListener("slidechanged",u),u()),d.multiplex&&(t.addKeyBinding({keyCode:65,key:"A",description:"Show share url"},(function(){c(e.multiplexImage,e.multiplexUrl)})),window.addEventListener("load",g),t.addEventListener("slidechanged",g),t.addEventListener("fragmentshown",g),t.addEventListener("fragmenthidden",g),t.addEventListener("overviewhidden",g),t.addEventListener("overviewshown",g),t.addEventListener("paused",g),t.addEventListener("resumed",g),t.addEventListener("enable-zoom",g),t.addEventListener("disable-zoom",g),g()),window.localStorage){const t=JSON.parse(window.localStorage.getItem("presentations")||"{}");t[d.shareUrl.replace(/#.*/,"")]={hash:e.hash,remoteId:e.remoteId,multiplexId:e.multiplexId},window.localStorage.setItem("presentations",JSON.stringify(t))}};function u(){o.emit("notes_changed",{text:t.getSlideNotes()}),p()}function p(){o.emit("state_changed",{isFirstSlide:t.isFirstSlide(),isLastSlide:t.isLastSlide(),isOverview:t.isOverview(),isPaused:t.isPaused(),isAutoSliding:t.isAutoSliding(),progress:t.getProgress(),slideCount:t.getTotalSlides(),indices:t.getIndices(),availableRoutes:t.availableRoutes(),autoslide:"number"==typeof l.autoSlide&&l.autoSlide>0&&("boolean"!=typeof l.autoSlideStoppable||!l.autoSlideStoppable)})}function g(){const e=t.getState(),n=t.getPlugin("remote-zoom"),i=n?n.getCurrentZoom():null;o.emit("multiplex",{state:e,zoom:i})}function v(){r.style.display="none"}function h(e){const o=t.getPlugin("remote-zoom");t.setState(e.state),o&&o.setCurrentZoom(e.zoom)}function w(e,t){s[e]=t}function y(e){const t=e.command;s.hasOwnProperty(t)?s[t]():console.log("Remote: No listener registered for",t,Object.keys(s))}l=t.getConfig(),"object"==typeof l.remote&&(d=function(e,t){for(const o in t)e[o]=t[o];return e}(d,l.remote)),!1===d.multiplex&&!1===d.remote||(console.log("Remote: connecting to",d.server+d.path),o=e.io.connect(d.server,{path:d.path}),o.on("connect_error",(function(e){console.warn("Remote: Could not connect to socket.io-remote server",e)})),o.on("reconnect_error",(function(e){console.warn("Remote: Could not reconnect to socket.io-remote server",e)})),o.on("connect_timeout",(function(){console.warn("Remote: Could not connect to socket.io-remote server (timeout)")})),o.on("reconnect_failed",(function(e){console.warn("Remote: Could not reconnect to socket.io-remote server - this was the last try, giving up",e)})),o.on("error",(function(e){console.warn("Remote: Unknown error in socket.io",e)})),o.on("connect",a),o.on("init",m),o.on("client_connected",v),d.multiplex&&void 0!==l.remoteMultiplexId&&(o.on("multiplex",h),t.configure({controls:!1,keyboard:!1,touch:!1,help:!1})),d.remote&&(o.on("command",y),w("next",t.next),w("prev",t.prev),w("up",t.up),w("down",t.down),w("left",t.left),w("right",t.right),w("overview",t.toggleOverview),w("pause",t.togglePause),w("autoslide",t.toggleAutoSlide)),function(){const e=document.getElementsByTagName("body")[0],t=document.createElement("div");n=document.createElement("a"),i=document.createElement("img"),r=document.createElement("div"),r.class="remote-qr-overlay",r.style.display="none",r.style.position="fixed",r.style.left="0",r.style.top="0",r.style.bottom="0",r.style.right="0",r.style.zIndex="1000",r.style.alignItems="center",r.style.justifyContent="center",t.style.padding="50px",t.style.borderRadius="50px",t.style.textAlign="center",t.style.background="rgba(255, 255, 255, .9)",n.target="_blank",n.style.fontSize="200%",i.style.border="20px solid white",r.appendChild(t),t.appendChild(n),n.appendChild(i),n.appendChild(document.createElement("br")),n.appendChild(document.createElement("br")),n.appendChild(document.createTextNode("Or share this link")),e.appendChild(r)}(),console.info("Remote: Starting connection"))};return()=>({id:"RevealRemote",init:t})}(io);
